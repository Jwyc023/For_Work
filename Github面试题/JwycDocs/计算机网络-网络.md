# 4.1.1 网络层的功能（路由选择与分组转发、异构网络互连、拥塞控制）

## 主要任务与传输单位

把分组从源端传到目的端，为分组交换网上的不同主机提供通信服务。网络层传输单位是数据报。

## 路由选择与分组转发

路由器主要完成两个功能:一是**路由选择** (确定哪一条路径)，二是**分组转发** (当一个分组到达时所采取的动作)。

```markdown
1)路由选择。指按照复杂的分布式算法，根据从各相邻路由器所得到的关于整个网络拓扑
的变化情况，动态地改变所选择的路由。
2)分组转发。指路由器根据转发表将用户的IP数据报从合适的端口转发出去。
```

路由表是根据路由选择算法得出的，而转发表是从路由表得出的。
路由表则需要对网络拓扑变化的计算最优化,转发表的结构应当使查找过程最优化。
在讨论路由选择的原理时，往往不去区分转发表和路由表，而是笼统地使用路由表一词。

## 异构网络互联

所谓`异构网络互联`，是指将两个以上的不同的计算机网络，通过一定的方法， 用一种或多种通信处理设备(即中间设备)相互连接起来，以构成更大的网络系统。中间设备又称`中间系统`或`中继系统`。根据所在的层次，·`中继系统`分为以下4种:

- 1)物理层中继系统:中继器，集线器(Hub)。
- 2)数据链路层中继系统:网桥或交换机。
- 3)网络层中继系统:路由器。
- 4)网络层以上的中继系统:网关。

`网络互联`通常是指用`路由器`进行网络互联和路由选择。
`路由器`是一一台专用计算机，用于在互联网中进行`路由选择。

## 拥塞控制

在通信子网中，因出现过量的分组而引起网络性能下降的现象称为`拥塞`。

`判断网络是否进入拥塞状态的方法`是，观察网络的`吞吐量与网络负载的关系`:如果随着`网络负载的增加`，`网络的吞吐量明显小于正常的吞吐量`，那么网络就可能已进入“`轻度拥塞”`状态;如果`网络的负载继续增大`，而网络的`吞吐量下降到零`，那么网络就可能已进入`死锁状态`。

`拥塞控制的作用是确保子网能够承载所达到的流量`，这是一一个全局性的过程，涉及各方面的行为:主机、路由器及路由器内部的转发处理过程等。单一地增加资源并不能解决拥塞。

`流量控制`和`拥塞控制`的`区别`:

- `流量控制`往往是指在**发送端和接收端之间**的点对点通信量的控制。流量控制所要做的是抑制发送端发送数据的速率，以便使接收端来得及接收。

- `拥塞控制`必须确保**通信子网能够传送待传送的数据**，是一一个全局性的问题，涉及网络中所有的主机、路由器及导致网络传输能力下降的所有因素。

拥塞控制的方法有两种:

1) 开环控制。在设计网络时事先将有关发生拥塞的因素考虑周到，力求网络在工作时不产生拥塞。这是一种静态的预防方法。一旦整个系统启动并运行，中途就不再需要修改。开环控制手段包括确定何时可接收新流量、何时可丢弃分组及丢弃哪些分组，确定何种调度决策等。所有这些手段的共性是，在做决定时不考虑当前网络的状态。
2) 闭环控制。事先不考虑有关发生拥塞的各种因素，采用监测网络系统去监视，及时检测哪里发生了拥塞，然后将拥塞信息传到合适的地方，以便调整网络系统的运行，并解决出现的问题。闭环控制是基于反馈环路的概念，是一种动态的方法。
   

# 4.1.2 计算机网络之（电路交换、报文交换、分组交换--数据报--虚电路）

## 几种传输单元名词解析

![4.1. 几种传输单元名词解析](D:\学习用\找工作\For_Work\Github面试题\JwycDocs\计算机网络图片\4.1. 几种传输单元名词解析.png)

这里探讨的电路交换、报文交换、分组交换，我们可以把这三种交换方式的交换数据单位看成一个整体去理解，不要过分去细究以上几种传输单元名词与这三种交换方式的关系。

## 电路交换

![4.1. 电路交换](D:\学习用\找工作\For_Work\Github面试题\JwycDocs\计算机网络图片\4.1. 电路交换.png)

在进行数据传输前，两个结点之间必须先建立一条专用 (双方独占)的物理通信路径(由通信双方之间的交换设备和链路逐段连接而成)，该路径可能经过许多中间结点。这一路径在整个数据传输期间一直被独占，直到通信结束后才被释放。

因此，电路交换技术分为三个阶段:连接建立、数据传输和连接释放。

从通信资源的分配角度来看，“交换”就是按照某种方式动态地分配传输线路的资源。电路交换的关键点是，在数据传输的过程中，用户始终占用端到端的固定传输带宽。

电路交换技术的优点如下:
1)通信时延小。由于通信线路为通信双方用户专用，数据直达，不需要对数据做检测，因此传输数据的时延非常小。当传输的数据量较大时，这-优点非常 明显。
2)有序传输。双方通信时按发送顺序传送数据，不存在失序问题。
3)没有冲突。不同的通信双方拥有不同的信道，不会出现争用物理信道的问题。
4)适用范围广。电路交换既适用于传输模拟信号，又适用于传输数字信号。
5)实时性强。通信双方之间的物理通路一旦建立， 双方就可以随时通信。
6)控制简单。电路交换的交换设备(交换机等)及控制均较简单。

电路交换技术的缺点如下:
1)建立连接时间长。电路交换的平均连接建立时间对计算机通信来说太长。
2)线路独占，使用效率低。电路交换连接建立后，物理通路被通信双方独占，即使通信线
路空闲，也不能供其他用户使用，因而信道利用率低。
3)灵活性差。只要在通信双方建立的通路中的任何一点出了故障，就必须重新拨号建立新
的连接，这对十分紧急和重要的通信是很不利的。
4)难以规格化。电路交换时，数据直达，不同类型、不同规格、不同速率的终端很难相互
进行通信，也难以在通信过程中进行差错控制。

注意，电路建立后，除源结点和目的结点外，电路上的任何结点都采取“直通方式”接收数
据和发送数据，即不会存在存储转发所耗费的时间。

## 报文交换

![4.1. 报文交换](D:\学习用\找工作\For_Work\Github面试题\JwycDocs\计算机网络图片\4.1. 报文交换.png)

数据交换的单位是报文，报文携带有源地址，目标地址，数据等信息。

报文交换的主要特点是：存储接受到的报文，判断其目标地址以选择路由，最后，在下一跳路由空闲时，将数据转发给下一跳路由。 中文名报文交换，外文名Message switching。在到达一个交换设备后停一会，等有链路空闲了就传输出去。

报文交换技术的优点如下:
1)无须建立连接。报文交换不需要为通信双方预先建立一条专用的通信线路，不存在建立
连接时延，用户可以随时发送报文。
2)动态分配线路。当发送方把报文交给交换设备时，交换设备先存储整个报文，然后选择
一条合适的空闲线路，将报文发送出去。
3)提高线路可靠性。如果某条传输路径发生故障，那么可重新选择另一条路径传输数据，
因此提高了传输的可靠性。
4)提高线路利用率。通信双方不是固定占有一条通信线路，而是在不同的时间一段一段地
部分占有这条物理通道，因而大大提高了通信线路的利用率。
5)提供多目标服务。一个报文可以同时发送给多个目的地址，这在电路交换中是很难实现的。

报文交换技术的缺点如下:
1)由于数据进入交换结点后要经历存储、转发这一过程，因此会引起转发时延(包括接收
报文、检验正确性、排队、发送时间等)。
2)报文交换对报文的大小没有限制，这就要求网络结点需要有较大的缓存空间。

注意:报文交换主要使用在早期的电报通信网中，现在较少使用，通常被较先进的分组交换
方式所取代。

## 分组交换

![4.1. 分组交换](D:\学习用\找工作\For_Work\Github面试题\JwycDocs\计算机网络图片\4.1. 分组交换.png)

同报文交换一样，分组交换也采用存储转发方式，但解决了报文交换中大报文传输的问题。分组交换限制了每次传送的数据块大小的上限，把大的数据块划分为合理的小数据块，再加上一些必要的控制信息(如源地址、目的地址和编号信息等)，构成分组(Packet)。 网络结点根据控制信息把分组送到下一结点，下一结点接收到分组后，暂时保存并排队等待传输，然后根据分组控制信息选择它的下一个结点，直到到达目的结点。到达目地之后的数据分组再重新组合起来，形成一条完整的数据。

分组交换的优点如下:
1)无建立时延。不需要为通信双方预先建立一条专用的通信线路，不存在连接建立时延，用户可随时发送分组。
2)线路利用率高。通信双方不是固定占有- -条通信线路，而是在不同的时间一-段一段地部分占有这条物理通路，因而大大提高了通信线路的利用率。
3)简化了存储管理(相对于报文交换)。因为分组的长度固定，相应的缓冲区的大小也固定，在交换结点中存储器的管理通常被简化为对缓冲区的管理，相对比较容易。
4)加速传输。分组是逐个传输的，可以使后-一个分组的存储操作与前一一个分组的转发操作并行，这种流水线方式减少了报文的传输时间。此外，传输一个分组所 需的缓冲区比传输一次报文所需的缓冲区小得多，这样因缓冲区不足而等待发送的概率及时间也必然少得多。
5)减少了出错概率和重发数据量。因为分组较短，其出错概率必然减小，所以每次重发的数据量也就大大减少，这样不仅提高了可靠性，也减少了传输时延。

分组交换的缺点如下:
1)存在传输时延。尽管分组交换比报文交换的传输时延少，但相对于电路交换仍存在存储转发时延，而且其结点交换机必须具有更强的处理能力。
2)需要传输额外的信息量。每个小数据块都要加上源地址、目的地址和分组编号等信息，从而构成分组，因此使得传送的信息量增大了5%~10%，一定程度上降低了通信效率，增加了处理的时间，使控制复杂，时延增加。
3)当分组交换采用数据报服务时，可能会出现失序、丢失或重复分组，分组到达目的结点时，要对分组按编号进行排序等工作，因此很麻烦。若采用虚电路服务，虽无失序问题，但有呼叫建立、数据传输和虚电路释放三个过程。

分组交换根据其通信子网向端点系统提供的服务，还可进一步分为面向连接的虚电路方式和
无连接的数据报方式。这两种服务方式都由网络层提供。要注意数据报方式和虚电路方式是分组交换的两种方式。
![4.1. 虚电路VS数据报](D:\学习用\找工作\For_Work\Github面试题\JwycDocs\计算机网络图片\4.1. 虚电路VS数据报.png)

### 数据报

![4.1. 数据报1](D:\学习用\找工作\For_Work\Github面试题\JwycDocs\计算机网络图片\4.1. 数据报1.png)

作为通信子网用户的端系统发送一个报文时，在端系统中实现的高层协议先把报文拆成若干带有序号的数据单元，并在网络层加上地址等控制信息后形成数据报分组(即网络层PDU)。中间结点存储分组很短一段时间，找到最佳的路由后，尽快转发每个分组。不同的分组可以走不同的路径，也可以按·不同的顺序到达目的结点。

### 虚电路

![4.1. 虚电路](D:\学习用\找工作\For_Work\Github面试题\JwycDocs\计算机网络图片\4.1. 虚电路.png)

在虚电路方式中，端系统每次建立虚电路时，选择一个未用过的虚电路号分配给该虛电路，以区别于本系统中的其他虚电路。在传送数据时，每个数据分组不仅要有分组号、校验和等控制信息，还要有它要通过的虚电路号，以区别于其他虚电路上的分组。在虚电路网络中的每个结点上都维持–张虚电路表，表中的每项记录了一个打开的虚电路的信息，包括在接收链路和发送链路上的虚电路号、前一结点和下一结点的标识。数据的传输是双向进行的，上述信息是在虚电路的建立过程中确定的。
虚电路之所以是“虚”的，是因为这条电路不是专用的·，每个结点到其他结点之间的链路可能同时有若干虚电路通过，也可能同时与多个结点之间建立虚电路。每条虚电路支持特定的两个端系统之间的数据传输，两个端系统之间也可以有多条虚电路为不同的进程服务，这些虚电路的实际路由可能相同也可能不同。

### 数据报服务和虛电路服务的比较

![4.1. 虚电路VS数据报](D:\学习用\找工作\For_Work\Github面试题\JwycDocs\计算机网络图片\4.1. 虚电路VS数据报.png)

